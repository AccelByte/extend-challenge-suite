# E2E Test Environment Variables
# Copy this file to .env and fill in your credentials
# Usage: set -a && source .env && set +a && ./test-login-flow.sh

# =====================================================
# TEST MODE CONFIGURATION
# =====================================================

# Authentication mode: mock | password | client
# - mock: Use mock JWT with USER_ID (default for local testing)
# - password: Use real user authentication (requires user credentials below)
# - client: Use client credentials (requires client credentials below)
AUTH_MODE=mock

# =====================================================
# SERVICE URLS
# =====================================================

# Backend service URL (Challenge Service REST API)
BACKEND_URL=http://localhost:8000/challenge

# Event handler URL (gRPC service for triggering events)
EVENT_HANDLER_URL=localhost:6566

# AccelByte IAM URL (for authentication)
IAM_URL=https://demo.accelbyte.io/iam

# AccelByte Platform URL (for reward verification)
PLATFORM_URL=https://demo.accelbyte.io/platform

# Namespace (your AccelByte namespace)
# Note: Use "test" for local development (matches .env in project root)
NAMESPACE=test

# =====================================================
# MOCK MODE CREDENTIALS (default for local testing)
# =====================================================

# User ID - Required for all authentication modes
# - Mock mode: Use test-user-e2e (default below)
# - Password mode: MUST set to your actual AGS user ID (see PASSWORD MODE section below)
USER_ID=test-user-e2e

# =====================================================
# PASSWORD MODE CREDENTIALS (for real user authentication)
# =====================================================

# User email and password (for Challenge Service operations)
# Required when AUTH_MODE=password
# EMAIL=user@example.com
# PASSWORD=SecurePassword123!

# IMPORTANT: USER_ID must also be set for password mode!
# This should be the actual AGS user ID (UUID) from the JWT token's "sub" claim
# To find your user ID:
#   1. Log in to AGS Admin Portal
#   2. Navigate to: IAM > Users > Search for your user email
#   3. Copy the User ID (UUID format)
#   4. Set it here
# USER_ID=12345678-1234-1234-1234-123456789abc

# OAuth client credentials for password grant
# This client must be configured to allow password grant type
# CLIENT_ID=user-client-id
# CLIENT_SECRET=user-client-secret

# =====================================================
# ADMIN CREDENTIALS (for Platform Service verification)
# =====================================================

# Admin client credentials (for dual token mode)
# These credentials are used for Platform Service verification
# Requires admin permissions to query entitlements and wallets
# ADMIN_CLIENT_ID=admin-client-id
# ADMIN_CLIENT_SECRET=admin-client-secret

# Note: Admin credentials are OPTIONAL
# - If not provided, tests will skip AGS Platform verification
# - Tests will still validate Challenge Service behavior (claim status in database)
# - For full E2E testing with AGS, provide admin credentials

# =====================================================
# DEMO APP BINARY PATH
# =====================================================

# Path to the demo app binary (relative to test directory)
DEMO_APP=../../extend-challenge-demo-app/bin/challenge-demo

# =====================================================
# ACCELBYTE SDK ENVIRONMENT VARIABLES (Optional)
# =====================================================

# These are set automatically by the demo app based on IAM_URL and PLATFORM_URL
# You can override them here if needed for SDK configuration
# AB_BASE_URL=https://abtestdewa-competitive.internal.gamingservices.accelbyte.io
# AB_CLIENT_ID=your-client-id
# AB_CLIENT_SECRET=your-client-secret
# AB_NAMESPACE=your-namespace

# =====================================================
# USAGE EXAMPLES
# =====================================================

# Example 1: Mock mode (local testing, no AGS)
# -------------------------------------------------
# AUTH_MODE=mock
# USER_ID=test-user-e2e
# BACKEND_URL=http://localhost:8000/challenge
# EVENT_HANDLER_URL=localhost:6566
# NAMESPACE=test
#
# Run: ./test-login-flow.sh

# Example 2: Password mode with user credentials only
# -------------------------------------------------
# AUTH_MODE=password
# EMAIL=user@example.com
# PASSWORD=SecurePassword123!
# CLIENT_ID=user-client-id
# CLIENT_SECRET=user-client-secret
# IAM_URL=https://demo.accelbyte.io/iam
# BACKEND_URL=http://localhost:8000/challenge
# NAMESPACE=your-namespace
#
# Run: ./test-login-flow.sh

# Example 3: Dual token mode (user + admin for full verification)
# -------------------------------------------------
# AUTH_MODE=password
# EMAIL=user@example.com
# PASSWORD=SecurePassword123!
# CLIENT_ID=user-client-id
# CLIENT_SECRET=user-client-secret
# ADMIN_CLIENT_ID=admin-client-id
# ADMIN_CLIENT_SECRET=admin-client-secret
# IAM_URL=https://demo.accelbyte.io/iam
# PLATFORM_URL=https://demo.accelbyte.io/platform
# BACKEND_URL=http://localhost:8000/challenge
# NAMESPACE=your-namespace
#
# Run: ./test-login-flow.sh
#
# This mode will:
# 1. Use user credentials for Challenge Service operations
# 2. Use admin credentials for Platform Service verification
# 3. Verify rewards are actually granted in AGS Platform

# =====================================================
# QUICK START
# =====================================================

# 1. Copy this file:
#    cp .env.example .env
#
# 2. Edit .env and fill in your credentials
#
# 3. Load environment variables and run tests:
#    set -a && source .env && set +a && ./test-login-flow.sh
#
# 4. Or run all tests:
#    set -a && source .env && set +a && ./run-all-tests.sh
#
# Note: set -a enables auto-export of all variables
#       set +a disables it after loading .env

# =====================================================
# TROUBLESHOOTING
# =====================================================

# Issue: "Demo app binary not found"
# Fix: Build the demo app first:
#      cd ../../extend-challenge-demo-app
#      go build -o bin/challenge-demo ./cmd/challenge-demo

# Issue: "Services are not running"
# Fix: Start services with docker-compose:
#      cd ../..
#      docker-compose up -d

# Issue: "Authentication failed" or "unknown client" error (password mode)
# Fix: Verify your credentials are correct:
#      - Email and password match a valid user in AGS
#      - Client ID and secret are valid OAuth clients (both required!)
#      - Client is configured for password grant type
#      - CLIENT_SECRET must be set in .env (required for OAuth2 Basic Auth)

# Issue: "Admin credentials not provided" warning
# Fix: This is just a warning, not an error
#      - Tests will still run but skip AGS verification
#      - To enable verification, add ADMIN_CLIENT_ID and ADMIN_CLIENT_SECRET

# Issue: "Entitlement not found" or "Wallet not found"
# Fix: Ensure the challenge configuration uses valid item UUIDs:
#      - For ITEM rewards, use item UUID (not SKU)
#      - For WALLET rewards, ensure currency exists in namespace

# Issue: "When using AUTH_MODE=password, you must set USER_ID in .env"
# Fix: Find your AGS user ID and add it to .env:
#      Option 1 - Via AGS Admin Portal:
#        1. Log in to AGS Admin Portal
#        2. Go to: IAM > Users
#        3. Search for your user by email
#        4. Copy the User ID (UUID format like: a1b2c3d4-...)
#        5. Add to .env: USER_ID=a1b2c3d4-...
#
#      Option 2 - Decode JWT token manually:
#        1. Get a JWT token from AGS (via login)
#        2. Go to https://jwt.io
#        3. Paste your JWT token
#        4. Look for the "sub" claim in the decoded payload
#        5. Copy that value as your USER_ID
#
#      Option 3 - Use mock mode instead:
#        Set AUTH_MODE=mock in .env (no real AGS authentication)
